# //   /etc/nginx/conf.d/proxy.conf

# server {
#     listen       80;
#     server_name  api.youtube.petersomond.com;

#     #────────────────────────────────────────────────────────────────────────
#     # 1) Handle CORS preflight (OPTIONS) at nginx level
#     #────────────────────────────────────────────────────────────────────────
#     if ($request_method = OPTIONS) {
#         add_header Access-Control-Allow-Origin  "https://www.youtube.petersomond.com" always;
#         add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
#         add_header Access-Control-Allow-Headers "Content-Type, Authorization, Cache-Control, X-Requested-With, Accept, Origin" always;
#         add_header Access-Control-Allow-Credentials "true" always;
#         add_header Access-Control-Max-Age 86400 always;
#         return 204;
#     }

#     #────────────────────────────────────────────────────────────────────────
#     # 2) ALB health‐check endpoint (no CORS needed for /api/health, but
#     #    nod to consistency)
#     #────────────────────────────────────────────────────────────────────────
#     location /api/health {
#         proxy_pass          http://127.0.0.1:3000/api/health;
#         proxy_http_version  1.1;
#         proxy_set_header    Upgrade $http_upgrade;
#         proxy_set_header    Connection "upgrade";
#         proxy_set_header    Host         $host;
#         proxy_cache_bypass  $http_upgrade;

#         # Echo CORS headers even on /api/health
#         add_header Access-Control-Allow-Origin  "https://www.youtube.petersomond.com" always;
#         add_header Access-Control-Allow-Credentials "true" always;
#         add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
#         add_header Access-Control-Allow-Headers "Content-Type, Authorization, Cache-Control, X-Requested-With, Accept, Origin" always;
#     }

#     #────────────────────────────────────────────────────────────────────────
#     # 3) Proxy ALL other /api traffic to Node on port 3000
#     #────────────────────────────────────────────────────────────────────────
#     location / {
#         proxy_pass          http://127.0.0.1:3000;
#         proxy_http_version  1.1;
#         proxy_set_header    Upgrade $http_upgrade;
#         proxy_set_header    Connection "upgrade";
#         proxy_set_header    Host         $host;
#         proxy_cache_bypass  $http_upgrade;

#         # Always add CORS headers to the proxied response
#         add_header Access-Control-Allow-Origin  "https://www.youtube.petersomond.com" always;
#         add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
#         add_header Access-Control-Allow-Headers "Content-Type, Authorization, Cache-Control, X-Requested-With, Accept, Origin" always;
#         add_header Access-Control-Allow-Credentials "true" always;
#     }
# }
